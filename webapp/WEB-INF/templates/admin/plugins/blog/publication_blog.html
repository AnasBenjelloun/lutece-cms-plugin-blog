	<@pageContainer id='publication_blog'>
    <@pageColumn>
		<@pageHeader title='#i18n{blog.manage_blogs.managePublication} "${blog.contentLabel}"'>
			<@aButton class='me-1' href='jsp/admin/plugins/blog/ManageBlogs.jsp?view=modifyBlog&id=${blog.id}' title='#i18n{blog.modify_blog.title}' buttonIcon='edit me-2' size='' />
			<@aButton class='me-1' href='jsp/admin/plugins/blog/ManageBlogs.jsp?view=historyBlog&amp;id=${blog.id}' title='#i18n{blog.manage_blogs.labelHistory}' buttonIcon='history me-2' size='' />
		</@pageHeader>
		<@tform boxed=true  name='publication_blog' params='enctype="multipart/form-data"' action='jsp/admin/plugins/blog/ManagePublicationBlogs.jsp'>
		<@messages errors=errors />
		<@input type='hidden' id='id' name='id' value='${blog.id}' />
		<#--
		<@row>
			<@columns sm=2 md=2 lg=1 >
				<@formGroup labelFor='portlet_filter_type' labelKey='#i18n{blog.publication_blog.labelSearchBy}' rows=2>
					<@select name='portlet_filter_type' id='portlet_filter_type' title='#i18n{blog.publication_blog.labelSearchBy}'>
						<#assign isSelected><#if portlet_filter??  && portlet_filter.portletFilterType = "page_id">true<#else>false</#if></#assign>
						<@option value='page_id' selected=isSelected?boolean label='#i18n{blog.publication_blog.labelSearchByIdPage}' />
						<#assign isSelected><#if portlet_filter??  && portlet_filter.portletFilterType = "page_name">true<#else>false</#if></#assign>
						<@option value='page_name' selected=isSelected?boolean label='#i18n{blog.publication_blog.labelSearchByPageName}' />
						<#assign isSelected><#if portlet_filter??  && portlet_filter.portletFilterType = "portlet_name">true<#else>false</#if></#assign>
						<@option value='portlet_name' selected=isSelected?boolean label='#i18n{blog.publication_blog.labelSearchByPortletName}' />
					</@select>
				</@formGroup>
			</@columns>
			<@columns sm=3>
				<@formGroup labelFor='portlet_filter_value' labelKey='#i18n{blog.manage_blogs.labelSearch}' rows=2>
					<#assign value><#if portlet_filter??>${portlet_filter.searchValue}</#if></#assign>
					<@input type='text' id='portlet_filter_value' name='portlet_filter_value' placeHolder='#i18n{blog.publication_blog.labelSearchBy}' value=value />
				</@formGroup>
			</@columns>
			<@columns sm=2>
				<@formGroup labelFor='order_portlet' labelKey='#i18n{blog.publication_blog.labelOrder}' rows=2>
					<@select name='order_portlet' title='#i18n{blog.publication_blog.labelOrder}'>
						<#assign isSelected><#if !order_portlet?? || order_portlet?? && order_portlet = 0>true<#else>false</#if></#assign>
						<@option value='0' selected=isSelected?boolean label='#i18n{blog.publication_blog.labelDateUpdatePortlet}' />
						<#assign isSelected><#if order_portlet?? && order_portlet = 1>true<#else>false</#if></#assign>
						<@option value='1' selected=isSelected?boolean label='#i18n{blog.publication_blog.labelPageName}' />
						<#assign isSelected><#if order_portlet?? && order_portlet = 2>true<#else>false</#if></#assign>
						<@option value='2' selected=isSelected?boolean label='#i18n{blog.publication_blog.labelPageId}' />
						<#assign isSelected><#if order_portlet?? && order_portlet = 3>true<#else>false</#if></#assign>
						<@option value='3' selected=isSelected?boolean label='#i18n{blog.publication_blog.labelPortletName}' />
					</@select>
				</@formGroup>
			</@columns>
			<@columns sm=2 md=2 lg=1 >
				<@formGroup labelFor='order_portlet_asc' labelKey='#i18n{blog.publication_blog.labelOrder}' rows=2>
					<@select name='order_portlet_asc'>
						<#assign isSelected><#if !order_portlet_asc?? || order_portlet_asc?? && order_portlet_asc = 0>true<#else>false</#if></#assign>
						<@option value='0' selected=isSelected?boolean label='#i18n{blog.publication_blog.labelOrderDesc}' />
						<#assign isSelected><#if order_portlet_asc?? && order_portlet_asc = 1>true<#else>false</#if></#assign>
						<@option value='1' selected=isSelected?boolean label='#i18n{blog.publication_blog.labelOrderAsc}' />
					</@select>
				</@formGroup>
			</@columns>
			<@columns sm=3 class='d-inline-flex'>
				<@formGroup labelKey='#i18n{blog.manage_blogs.labelSearch}' labelClass='invisible' rows=2>
				<@button type='submit' title='#i18n{blog.manage_blogs.search}' name='view_manageBlogsPublication' id='view_manageBlogsPublication'  buttonIcon='search' />
				<#if !portlet_filter?? || portlet_filter.displayLatestPortlets >
					<@input type='hidden' name='is_display_latest_portlets' value='false' />
				<#else>
					<@button type='submit' color='danger' class='btn-block' title='#i18n{blog.publication_blog.labelRemoveFilter}' name='view_manageBlogsPublication' buttonIcon='times' />
					<@input type='hidden' name='is_display_latest_portlets' value='true' />
				</#if>
				</@formGroup>
			</@columns>
		</@row>
	-->
		<@row>
			<@columns sm=12 md=6>
				<#if document_list_portlet_list?size &gt; 0>
					<#assign boxTitle>#i18n{blog.publication_blog.labelAvailablePortlet} #i18n{blog.publication_blog.labelAvailableDocumentListPortlet} <#if !portlet_filter?? || portlet_filter.displayLatestPortlets> ${label_display_latest_portlets} </#if></#assign>
					<@box>
						<@boxHeader title=boxTitle />
						<@boxBody>
							<#if document_list_portlet_list?size &gt; 0>
								<@listGroup params='style="height:40vh;overflow-y: auto"'>
									<#list document_list_portlet_list as portlet>
										<@listGroupItem class='d-flex justify-content-between vh-50' params='data-portlet="${portlet.id!} ${portlet.title!}" data-portletid="${portlet.id!}"'>
											<@span class='searchable mx-2 pt-1'>${portlet.code!}</@span>
											<@span class='searchable mx-2 pt-1 w-50'>${portlet.name!}</@span>
											<#--
											<@span class='searchable mx-2 pt-1'><@icon style='user' /> ${blog.userCreator}</@span>
											<@span class='searchable mx-2 pt-1 w-25'><@icon style='calendar-plus' /> ${blog.creationDate?string.short} <@icon style='calendar-cog ms-4' /> ${blog.updateDate?string.short}</@span>
											-->
										</@listGroupItem>
									</#list>
								</@listGroup>	
								<@select name='idPortlet' id='idPortlet' multiple=10 default_value=''params='style=\"overflow-x:scroll\" ' items=document_list_portlet_list  />
								<div class="invalid-feedback" role="alert" id="error_idPortlet"></div>
							<#else>
								<@empty  title='#i18n{blog.publication_blog.messagePortletNotExist}' />
							</#if>
							<@row class='input-daterange'>
								<@columns xs=6>
									<@formGroup labelFor='dateBeginPublishing' labelKey='#i18n{blog.publication_blog.labelPublicationDateBegin}' rows=2>
										<@inputGroup>
											<@input type='date' name='dateBeginPublishing' id='dateBeginPublishing' value='' format='d/m/Y' />
											<@inputGroupItem>
												<@icon style='calendar' />
											</@inputGroupItem>
										</@inputGroup>
									</@formGroup>
								</@columns>
								<@columns xs=6>
									<@formGroup labelFor='dateEndPublishing' labelKey='#i18n{blog.publication_blog.labelPublicationDateEnd}' rows=2>
										<@inputGroup>
											<@input type='date' name='dateEndPublishing' id='dateEndPublishing' value='' format='d/m/Y' />
											<@inputGroupItem>
												<@icon style='calendar' />
											</@inputGroupItem>
										</@inputGroup>
									</@formGroup>
								</@columns>
							</@row>
							<@formGroup rows=2>
								<@button type='submit' name='action_publishDocument' id='action_publishDocument' title='#i18n{blog.publication_blog.buttonPublish}' buttonIcon='check' title='#i18n{blog.publication_blog.buttonPublish}' />
							</@formGroup>
						</@boxBody>
					</@box>
				<#else>
					<@callOut color='warning'><@icon style='exclamation-circle' />  #i18n{blog.publication_blog.messagePortletNotExist}</@callOut>
				</#if>
		</@columns>
		<@columns sm=12 md=6>
			<@box>
				<@boxHeader title='#i18n{blog.publication_blog.labelPublishedPost}' />
				<@boxBody>
					<#if blog.blogPublication?size &gt; 0>
						<@listGroup>
							<#list blog.blogPublication?sort_by("idPortlet") as publication>
							<@listGroupItem class='d-flex justify-content-between'>
								<@span class='mx-2 pt-1'>[ #i18n{blog.modify_blog.labelPage} ${publication.portlet.pageId} ] ${publication.portlet.name}</@span>
								<@span class='mx-2 pt-1'>#i18n{blog.publication_blog.labelPublishedFrom} ${publication.dateBeginPublishing} #i18n{blog.publication_blog.labelPublishedTo} ${publication.dateEndPublishing} </@span>
								<@btnGroup>
									<@aButton href='jsp/admin/plugins/blog/ManagePublicationBlogs.jsp?action=unPublishDocument&amp;idBlog=${blog.id}&amp;&idPortlet=${publication.idPortlet}&amp;id=${blog.id}' title="#i18n{blog.publication_blog.buttonUnPublish}" color='danger' hideTitle=['all'] buttonIcon='trash' />
									<@link href='jsp/admin/site/AdminSite.jsp?page_id=${publication.portlet.pageId}' class="btn btn-outline-primary" title="#i18n{blog.publication_blog.labelPublishedFrom} ${publication.dateBeginPublishing} #i18n{blog.publication_blog.labelPublishedTo} ${publication.dateEndPublishing}">
										<@icon style='external-link' />
									</@link>
								</@btnGroup>
							</@listGroupItem>
							</#list>
						</@listGroup>
					</#if>
			</@boxBody>
			</@box>
		</@columns>
	</@row>
	</@tform>
	</@pageColumn>
</@pageContainer>
<#--
<#if portlet_filter_error??>
	<@initToast id='blogToastContainer' >
		<#assign errorText><@icon style='exclamation-circle' /> ${portlet_filter_error!}</#assign>
		<@addToast content=errorText class='text-bg-warning' />
	</@initToast>
</#if>
-->
<script>
document.addEventListener('DOMContentLoaded', () => {
	const btnPublish = document.getElementById('action_publishDocument'),
		listPortlet = document.getElementById('idPortlet'),
		listPortletError = document.querySelector('#idPortlet + .invalid-feedback'),
		listPortletOption = listPortlet.querySelectorAll('option')
	btnPublish.addEventListener('click', (e) => {
		let isSelected = 0
		listPortletOption.forEach( (p) => {
			if( p.selected === true ){
				isSelected++
			} 
		})

		let msgError = '';
		if( isSelected === 0 ){
			msgError = 'Vous devez sélectionner un billet !'
		}
		if( isSelected > 1 ){
			msgError = 'Vous ne pouvez sélectionner q\'un seul billet !'
		}
		
		if( msgError !='' ){
			e.preventDefault()
			listPortletError.textContent = msgError
			listPortlet.classList.add('is-invalid')
		}

	})
})
</script>