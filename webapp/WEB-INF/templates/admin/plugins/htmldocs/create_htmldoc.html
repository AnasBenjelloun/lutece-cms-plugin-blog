<@rowBoxHeader i18nTitleKey="#i18n{htmldocs.create_htmldoc.title}">
  <form class="form-horizontal" method="post" name="create_htmldoc" enctype="multipart/form-data" action="jsp/admin/plugins/htmldocs/ManageHtmlDocs.jsp">
    <@messages errors=errors />
    <input type="hidden" id="id" name="id"/>
    <input type="hidden" id="action" name="action" value="createHtmlDoc"/>
    <input id="tag_remove" type="hidden" name="tag_remove" value="" ></input>
    <#include "/admin/util/editor/editor.html" />
    <@fieldInputText i18nLabelKey="htmldocs.create_htmldoc.labelContentLabel" inputName="content_label" mandatory=true value="${htmldoc.contentLabel!''}" i18nHelpBlockKey="htmldocs.create_htmldoc.labelContentLabel.help" />

    <div class="form-group">
		<label class="col-xs-12 col-sm-3 col-md-3 col-lg-3 control-label" for="description">#i18n{htmldocs.create_htmldoc.labelDescription}&nbsp;&nbsp;:</label>
		<div class="col-xs-12 col-sm-9 col-md-6 col-lg-6">

			   <textarea id="description" class="richtext" name="description" rows="12">   ${htmldoc.description!}    </textarea>

			<p class="help-block">#i18n{htmldocs.create_htmldoc.labelDescription.help} (help text)</p>
		</div>
    </div>
     <div class="form-group">
		<label class="col-xs-12 col-sm-3 col-md-3 col-lg-3 control-label" for="html_content">#i18n{htmldocs.create_htmldoc.labelEditContent}&nbsp;&nbsp;:</label>
		<div class="col-xs-12 col-sm-9 col-md-6 col-lg-6">

    	<textarea id="html_content" class="richtext" name="html_content" rows="12">     ${htmldoc.htmlContent!}  </textarea>

			<p class="help-block"></p>
		</div>
    </div>

    
    <@initEditor />
    <@fieldInputText i18nLabelKey="htmldocs.create_htmldoc.labelEditComment" inputName="edit_comment" mandatory=false value="${htmldoc.editComment!''}" i18nHelpBlockKey="htmldocs.create_htmldoc.labelEditComment.help" />
	<@fieldInputCheckBox i18nLabelKey="htmldocs.create_htmldoc.labelShareable" inputName="shareable" value="true" disabled=false checked=false i18nHelpBlockKey='htmldocs.create_htmldoc.labelShareable.help' cssClass='' />
	<div class="form-group">
	<label class="col-xs-12 col-sm-3 col-md-3 col-lg-3 control-label" for="attachment">Piece jointe</label>
	<div class="col-xs-12 col-sm-9 col-md-6 col-lg-6">
		<input tabindex="-1" style="position: absolute; clip: rect(0px, 0px, 0px, 0px);" class="filestyle" name="attachment" id="attachment" type="file">
		
	</div>
    </div>
   

    <@actionButtons button1Name="action_createHtmlDoc" button2Name="view_manageHtmlDocs"/>
  </form>
 <div class="form-group" style="position: absolute; top: 0px; right: 0px;">
	        <div class="">	
		<label class=" control-label" for="description">Tag&nbsp;&nbsp;:</label>

  		<@comboWithParams name="tag_doc" default_value="" additionalParameters="class=\"input-xxlarge\"" items=list_tag />
		<button type="submit" value="addTag" name="addTag" class="btn btn-primary btn-sm btn-flat" onClick="addIdEntry()">
			<i class="glyphicon glyphicon-ok-circle"></i>&nbsp;
		</button>

    		<p id="tag" class="help-block"></p>
		 <#list htmldoc.tag as tg>
		<#list list_tag as tgName>
			<#if tgName.code == tg.idTag?string > 
				<div id="${tg.idTag}">
				${tgName.name!}
				<button  type="submit" value="removeTag" name="removeTag" class="btn btn-danger btn-small" onClick="removeEntry(${tg.idTag}, '${tgName.name!}');">
					<i class="fa fa-trash"></i>&nbsp;
	   			</button>
				</div>
				  <#break>
			</#if>
		</#list>
		</#list>
	</div>
    </div>
</@rowBoxHeader>
<script>
var baseUrl = document.getElementsByTagName('base')[0].href;

function removeEntry(idEntry, tgName){
	$('#tag_remove').val(idEntry);
	doDeleteTag(idEntry, tgName);
}

function addIdEntry(){
	
	doAddTag($('select#tag_doc').val(),$('#tag_doc option:selected').text());
}


function doAddTag( idTag, tgName )

{

	$.ajax({

            url : baseUrl + "jsp/admin/plugins/htmldocs/DoAddTag.jsp?action=addTag&tag_doc="+idTag,

	    type: 'GET',

	    dataType: "json",

	    data: {},

            async: false,

	    cache:false,

            success:function(data) {

        	if ( data.status == 'OK' )

    		{
			$( "#tag" ).append("<div id="+idTag+"> "+tgName+ "<button id='"+idTag+"' type='submit' value='removeTag' name='removeTag' class='btn btn-danger btn-small' onClick=removeEntry("+idTag+",'"+tgName+"');><i class='fa fa-trash'></i>&nbsp;</button> </div> ");

			$('#tag_doc option:selected').detach();
        	}

        	else
		{

			alert("echec")

		}

		},

          error: function(jqXHR, textStatus, errorThrown) {
		alert("error")
          }

	});

}
    
function doDeleteTag( idTag, tgName  )

{

	
	$.ajax({

            url : baseUrl + "jsp/admin/plugins/htmldocs/DoDeleteTag.jsp?action=removeTag&tag_doc="+idTag,

	    type: 'GET',

	    dataType: "json",

	    data: {},

            async: false,

	    cache:false,

            success:function(data) {

        	if ( data.status == 'OK' )

    		{
			$('#'+idTag).detach();
			$('#tag_doc').append("<option value="+idTag+">"+tgName+"</option>")
			
        	}

        	else
		{

			alert("echec")

		}

		},

          error: function(jqXHR, textStatus, errorThrown) {
		alert("error")
          }

	});

}


  </script>
 